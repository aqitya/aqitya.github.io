<!DOCTYPE html>
<html>
<head>
    <title>My Portfolio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
            line-height: 1.6;
        }
        h1 {
            color: #2a9d8f;
            font-size: 36px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        h3, h4 {
            color: #264653;
            border-left: 5px solid #2a9d8f;
            padding-left: 10px;
            margin-bottom: 15px;
        }
        h4 {
            font-size: 20px;
        }
        p {
            font-size: 18px;
            color: #555;
        }
        figcaption {
            color: #555;
            font-style: italic;
        }
        .image-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        figure {
            margin: 20px;
        }
        figure img {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        body blockquote {
            font-size: 18px;
            color: #e76f51;
            margin-left: 20px;
            border-left: 5px solid #e76f51;
            padding-left: 15px;
        }
        .centered-text {
            text-align: center;
        }
    </style>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h1> IMAGE WARPING and MOSAICING! (part a)</h1>

  <body> From Project Descritpion: "The goal of this assignment is to get your hands dirty in different aspects of image warping with a “cool” application -- image mosaicing. You will take two or more photographs and create an image mosaic by registering, projective warping, resampling, and compositing them. Along the way, you will learn how to compute homographies, and how to use them to warp images."</body>

  <h3> Shooting the Images </h3>

  <body> Unfortunately, at the time of me shooting these images, I am TERRIBLY sick. So, had to result in taking photos of my messy apartment and from the balcony of FSM...</body>

  <div class="image-row">
        <figure>
            <img src="images/C1_25.png" alt="Counter1" width="450">
            <figcaption> Picture of Counter Angle 1</figcaption>
        </figure>
        <figure>
            <img src="images/C2_25.png" alt="Counter2" width="450">
            <figcaption>Picture of Counter Angle 2</figcaption>
        </figure>
    </div>

    <div class="image-row">
        <figure>
            <img src="images/fsm1_25.jpg" alt="FSM1" width="450">
            <figcaption> Picture of FSM Balacony</figcaption>
        </figure>
        <figure>
            <img src="images/fsm2_25.jpg" alt="FSM2" width="450">
            <figcaption>Picture of FSM Balacony including more tree</figcaption>
        </figure>
    </div>


    <div class="image-row">
        <figure>
            <img src="images/gate1_25.jpg" alt="gate1" width="450">
            <figcaption> Picture of a Gate</figcaption>
        </figure>
        <figure>
            <img src="images/gate2_25.jpg" alt="gate2" width="450">
            <figcaption>Picture of a Gate more included</figcaption>
        </figure>
    </div>

    <div class="image-row">
        <figure>
            <img src="images/garden1_25.jpg" alt="garden1" width="450">
            <figcaption> Picture of a Garden</figcaption>
        </figure>
        <figure>
            <img src="images/garden2_25.jpg" alt="garden2" width="450">
            <figcaption>Another picture of the Garden</figcaption>
        </figure>
    </div>

    <h3> Recover Homographies </h3>

    <body> Before we wrap the images into alignment, we must first recover the parameters of the transformation between each pair of images.</body>

    <body>
        <h4>We want to recover a projective transformation such that</h4>
        <p>
            \[
            \begin{bmatrix}
            a & b & c \\
            d & e & f \\
            g & h & 1
            \end{bmatrix}
            \begin{bmatrix}
            x \\
            y \\
            1
            \end{bmatrix}
            =
            \begin{bmatrix}
            wx' \\
            wy' \\
            w
            \end{bmatrix}
            \]
        </p>
    
        <h4>Notice that if we expand this out, then we have the following system of equations:</h4>
        <p>
            \[
            \begin{cases}
            ax + by + c = wx' \\
            dx + ey + f = wy' \\
            gx + hy + 1 = w
            \end{cases}
            \implies
            \begin{cases}
            ax + by + c = (gx + hy + 1)x' \\
            dx + ey + f = (gx + hy + 1)y'
            \end{cases}
            \implies
            \begin{cases}
            ax + by + c - gxx' - hyx' = x' \\
            dx + ey + f - gxy' - hyy' = y'
            \end{cases}
            \]
        </p>

        <h4> Which we can finally transform to...</h4>
    
        <p>
            \[
            \implies
            \begin{bmatrix}
            x & y & 1 & 0 & 0 & 0 & -xx' & -yx' \\
            0 & 0 & 0 & x & y & 1 & -xy' & -yy'
            \end{bmatrix}
            \begin{bmatrix}
            a \\
            b \\
            c \\
            d \\
            e \\
            f \\
            g \\
            h
            \end{bmatrix}
            =
            \begin{bmatrix}
            x' \\
            y'
            \end{bmatrix}
            \]
        </p>

        <p> Thus, given some n amount of correspondence points, we can stack these equations to form a 2n * 9 matrix A. For each correspondence point (x, y) -> (x', y'), we formulate two equations: </p>

        <div class = 'centered-text'>
            <p>x'(h31x + h32y + h33) = h11x + h12y + h13</p>
            <p>y'(h31x + h32y + h33) = h21x + h22y + h23</p>
        </div>

        <p> These equations are what is used to construct A.</p>
        <p> Afterwards, we use SVD on A to solve for AH = b to construct H, which is our homography matrix.</p>
    </body>


    <h3> Warping Images </h3>

    <p> For warping, we take our Homography matrix H, and inverse it to an adjusted cordiante plane and warped points. This essentially maps out points in the warped image to the original image that we are attaching the warp to.</p>

    <p> Below are the correspondence points for the 'Counter' Images that I used.</p>

    <div class="image-row">
        <figure>
            <img src="warp/warp.png" alt="correspondence1" width="450">
            <figcaption>Correspondences on Counter 1</figcaption>
        </figure>
        <figure>
            <img src="warp/warp2.png" alt="correspondence2" width="450">
            <figcaption>Correspondences on Counter 2</figcaption>
        </figure>
    </div>

    <p> Afterwards, we can apply warp either Counter 1 to Counter 2, or vice versa. Shown below are both results!</p>

    <div class="image-row">
        <figure>
            <img src="warp/warped1.jpg" alt="warped1" width="450">
            <figcaption>Counter 1 Warped to Counter 2</figcaption>
        </figure>
        <figure>
            <img src="warp/warped2.jpg" alt="warped2" width="450">
            <figcaption>Counter 2 Warped to Counter 1</figcaption>
        </figure>
    </div>

    <p> NOTE: Warping the same image to itself results in the same image! A good sanity check to ensure you warp function isn't doing something crazy...</p>

    <h3> Image Rectification</h3>

    <p> Given that we are able to warp our images, we can rectify specfic objects in an image! Essentially we take a irregular quadilateral and can turn it into a regular rectangle. This can be done by selecting the correspondence points soley around the corners around the area of desire and choosing the second set of points as the corners of the image.</p>

    <p> Below are two examples of image rectification on some books that I enjoyed reading!</p>

    <div class="image-row">
        <figure>
            <img src="rect/rect1_25.jpg" alt="Rezero" width="450">
            <figcaption> Picture of Re:Zero Vol 1</figcaption>
        </figure>
        <figure>
            <img src="rect/rect2_25.jpg" alt="Jojo" width="450">
            <figcaption>Picture of JoJo's Part 3 Vol 1</figcaption>
        </figure>
    </div>

    <p> And the results...</p>

    <div class="image-row">
        <figure>
            <img src="rect/res1.png" alt="Rezero" width="750">
            <figcaption> Rectified Re:Zero Vol 1</figcaption>
        </figure>
        <figure>
            <img src="rect/res2.png" alt="Jojo" width="750">
            <figcaption> Rectified JoJo's Part 3 Vol 1</figcaption>
        </figure>
    </div>

    <h3> Blending Images to Create Mosaics</h3>

    <p> Finally, using our warping function, we can construct a mosaic between warped and original images (even warped to warped images if you really want).</p>

    <body> The process goes as follows... Compute Homography Matrix H between correspondence points from both images and choose either image (in our case, the first one, even both work). Given this image and H, we then apply our warping. During our warping process, I also specifically constructed output based on the warped image to help in creating the width and height of the final mosaic, as well as accomodating for any translatons. Afterwards, we place the warped image on the left and the unaltered second image on the right. Finally, to ensure clean results, we apply some blending techniques from Project 2. The only difference is, we have to accomodate for an irregular mask here. We can construct one by creating binary masks of both images on where there are pixels located and computing the distance transform on each of these masks to create weights for each image. The lowest frequency component is then blended using weights computed from distance transfoms. For the higher frequency, we use a binary to select between the two images based on which is closer at each pixel. </body>
    
    <body> Here we showcase two standard examples, one simple example, and one more extreme example of mosiacs created from the pictures. </body>

    <div class="image-row">
        <figure>
            <img src="images/C1_25.png" alt="Counter1" width="450">
            <figcaption> Picture of Counter Angle 1</figcaption>
        </figure>
        <figure>
            <img src="images/C2_25.png" alt="Counter2" width="450">
            <figcaption>Picture of Counter Angle 2</figcaption>
        </figure>
    </div>

    <div style="text-align: center;">
        <figure>
            <img src="mosaics/C_final.jpg" alt="counter mosaic" width="750">
            <figcaption>Standard Example - Mosaic of Counter</figcaption>
        </figure>
    </div>

    <body> Don't get tricked by bottom left! The shadow of the chair was naturally 'off-looking'... =]</body>

    <div class="image-row">
        <figure>
            <img src="images/fsm1_25.jpg" alt="FSM1" width="450">
            <figcaption> Picture of FSM Balacony</figcaption>
        </figure>
        <figure>
            <img src="images/fsm2_25.jpg" alt="FSM2" width="450">
            <figcaption>Picture of FSM Balacony including more tree</figcaption>
        </figure>
    </div>

    <div style="text-align: center;">
        <figure>
            <img src="mosaics/FSM_final.jpg" alt ="FSM mosaic" width = "750">
            <figcaption>Standard Example - Mosaic of FSM balcony</figcaption>
        </figure>
    </div>

    <body> Now here's a simple example. </body>

    <div class="image-row">
        <figure>
            <img src="images/gate1_25.jpg" alt="gate1" width="450">
            <figcaption> Picture of a Gate</figcaption>
        </figure>
        <figure>
            <img src="images/gate2_25.jpg" alt="gate2" width="450">
            <figcaption>Picture of a Gate more included</figcaption>
        </figure>
    </div>

    <div style="text-align: center;">
        <figure>
            <img src="mosaics/g_test.jpg" alt ="Gate mosaic" width = "750">
            <figcaption>Simple Example - Mosaic of a Gate</figcaption>
        </figure>
    </div>

    <body> This is simple since there is a lot of similarities between the two images. </body>

    <div class="image-row">
        <figure>
            <img src="images/garden1_25.jpg" alt="garden1" width="450">
            <figcaption> Picture of a Garden</figcaption>
        </figure>
        <figure>
            <img src="images/garden2_25.jpg" alt="garden2" width="450">
            <figcaption>Another picture of the Garden</figcaption>
        </figure>
    </div>

    <body> Now for an extreme example! </body>

    <div style="text-align: center;">
        <figure>
            <img src="mosaics/garden_test.jpg" alt ="Garden mosaic" width = "750">
            <figcaption>Extreme Example - Mosaic of a Garden</figcaption>
        </figure>
    </div>

    <body> This is more extreme since the angle of the pictures had been shifted from one to the other, hence the extreme tilt in the warped image compared to the non-warped image.</body>



</body>
</html>
